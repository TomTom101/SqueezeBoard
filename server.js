// Generated by CoffeeScript 1.8.0
var app, cmd, cors, cp, express, http;

cors = require('cors');

express = require('express');

app = express();

http = require('http').Server(app);

app.use(cors());

cp = require('child_process');

cmd = "/home/pi/airsensor/airsensor -o -j";

app.get('/stream', function(req, res) {
  var spw;
  res.writeHead(200, {
    'Content-Type': 'text/event-stream',
    'Cache-control': 'no-cache',
    'Connection': 'keep-alive'
  });
  spw = cp.spawn('/home/pi/airsensor/airsensor', ['-j']);
  spw.stdout.on('data', function(data) {
    var lines, out;
    out = data.toString();
    lines = out.split("\n");
    console.log(lines.length, lines);
    if (!(lines.length > 2)) {
      return res.write("data: " + lines[0] + "\n\n");
    }
  });
  return spw.on('close', function(code) {
    return res.end(str);
  });
});

http.listen(3001, function() {
  return console.log('listening on *:3001');
});
